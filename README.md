# Архиватор XArch: Справочник по режимам и флагам

## Таблица совместимости флагов

| Флаг            | Описание                  | Режимы                                                                 | Конфликты                          |
|------------------|---------------------------|-----------------------------------------------------------------------|------------------------------------|
| `-h`, `--help`   | Справка                   | Все режимы (автономно)                                               | Нельзя комбинировать с другими     |
| `-c`, `--compress`| Создание архива          | Только автономно                                                     | `-x`, `-a`, `-u`, `-T`             |
| `-x`, `--extract` | Распаковка архива        | Только автономно                                                     | `-c`, `-a`, `-u`, `-T`             |
| `-a`, `--append`  | Добавление в архив       | Только автономно                                                     | `-c`, `-x`, `-u`, `-T`             |
| `-u`, `--update`  | Обновление архива        | Только автономно                                                     | `-c`, `-x`, `-a`, `-T`             |
| `-T`, `--test`    | Тестирование архива      | Только автономно                                                     | `-c`, `-x`, `-a`, `-u`             |
| `-o`, `--output`  | Выходной файл            | Все, кроме `--help`                                                  | Обязателен для `-c`, `-x`, `-a`, `-u` |
| `-l`, `--level`   | Уровень сжатия (0-9)     | `-c`, `-a`, `-u`                                                     | Не работает с `-x`, `-T`           |
| `-s`, `--split`   | Размер тома (e.g., 100M) | `-c`                                                                 | Требует `-c`                       |
| `-d`, `--delete`  | Удалить исходные файлы   | `-c`, `-a`, `-u`                                                     | Только после успешного выполнения  |
| `-S`, `--self`    | SFX-архив                | `-c`                                                                 | Требует `-c`                       |

## Разрешённые операции

### Базовые сценарии
1. **Создание архива**  
   `xarch -c -f file1.txt -o archive.zip`
2. **Распаковка**  
   `xarch -x -o archive.zip`
3. **Добавление файлов**  
   `xarch -a -o existing.zip -f newfile.txt`
4. **Проверка целостности**  
   `xarch -T -o archive.zip`

### Комбинирование флагов
- Сжатие с максимальным уровнем:  
  `xarch -c -f data/ -o backup.zip -l 9 -s 500M`
- Распаковка с сохранением структуры:  
  `xarch -x -o backup.zip -r`

## Запрещённые операции
1. ❌ Комбинация режимов:  
   `xarch -c -x -o archive.zip`
2. ❌ Несовместимые флаги:  
   `xarch -T -o archive.zip -d`
3. ❌ Отсутствие обязательных параметров:  
   `xarch -c -l 5` (нет `-o`)

### Основные правила
1. **Только один основной режим** может быть активен за раз
2. `-h` (help) **несовместим** с другими режимами
3. `-o` (output) **обязателен** для всех режимов кроме `-h`

---

## Детализация режимов

### 1. Режим Compress (`-c`)
**Теория работы:**
- Собирает указанные файлы/папки в архив
- Применяет выбранный алгоритм сжатия
- Поддерживает разделение на тома

**Требуемые флаги:**
- `-f` / `--files` - входные файлы
- `-o` / `--output` - имя архива

**Опциональные флаги:**
- `-t` / `--type` - формат архива (по умолчанию: zip)
- `-l` / `--level` - уровень сжатия 0-9 (6)
- `-s` / `--split` - разделение на части (например, 100M)
- `-S` – создать SFX
- `-p` / `--password` - шифрование архива
- `-X` / `--exclude` - исключение файлов по шаблону

**Пример:**
```bash
xarch -c -f doc.pdf,images/ -o data.zip -l 9 -s 2G -S
```

### 2. Режим Extract ('-x')

**Теория работы:**
- Извлекает файлы из архива
- Восстанавливает структуру директорий
- Проверяет контрольные суммы

**Требуемые флаги:**
- `-o` / `--output` - имя архива

**Опциональные флаги:**
-`p` / `--password` - пароль для расшифровки
-`r` / `--preserve` - сохранять структуру каталогов

**Пример**
```bash
./xarch -x -o archive.zip -rp "mysecret"
```

### 3. Режим Append('-a')

**Теория работы:**
- Добавляет новые файлы в существующий архив
- Не изменяет уже существующие данные
- Поддерживает шифрование
**Требуемые флаги:**
-`f` / `--files` - добавляемые файлы
- `-o` / `--output` - существующий архив
**Особенности:**
- Поддерживает те же опции, что и Compress
- Нельзя менять тип архива
**Пример**
```bash
./xarch -x -o archive.zip -p "mysecret"
```



### 4. Режим Update('-u')
**Требуемые флаги:**

-`f` / `--files` - обновляемые файлы
- `-o` / `--output` - архив для обновления
  **Отличия от Append:**
- Заменяет существующие файлы в архиве
- Проверяет контрольные суммы
  **Пример**
```bash
./xarch -x -o archive.zip -p "mysecret"
```

---
## Особые случаи ##
Самораспаковывающиеся архивы (-S)
- Работает только с -c
- Требует указания типа архива



```bash
./xarch -c -f *.txt -o backup.zip -p "secret" -l 9
```
2. Распаковка с сохранением структуры:

```bash
./xarch -x -o backup.zip -r -d /target/path
```

### Недопустимые команды ###
1. Конфликт режимов:

```bash
./xarch -c -x -o archive.zip # Ошибка: нельзя одновременно сжимать и распаковывать
```
2. Пропущены обязательные параметры:

```bash
./xarch -c -o archive.zip # Ошибка: не указаны файлы (-f)
```

### Примечания ###
1. Приоритет флагов:
При конфликте параметров (например, разные уровни сжатия) последний указанный флаг имеет приоритет

2. Логирование:
Используйте --verbose для вывода подробной информации о процессе

3. Специальные символы:
Для путей с пробелами используйте кавычки:
-f "My Documents/file.txt"

4. Поддерживаемые форматы:
ZIP, TAR, 7Z (список может расширяться)
---

### 5. Тестирование ```Test```, ```--test``` ###
**Теория работы:**
- Проверяет целостность архива
- Верифицирует контрольные суммы
- Выводит список повреждённых файлов

**Обязательные флаги**
- ```-o``` -имя архива
**Пример**
```bash
xarch -T -o data.zip
```

---
### Валидация параметров ###

**Общие проверки**
1. Уровень сжатия ```0 <= -l <= 9```
2. Размер тома:
- Формат: ```Число[K|M|G] (e.g)```
- Минимум ```1K```
3. Тип архива ```zip, tar, 7z, rar```
### Краевые случаи ###
1. Пути файлов:
```bash 
xarch -c -f "file with spaces.txt" -o out.zip
```
2. Относительные пути:
```bash
xarch -c -f ../documents/ -o ~/backup.zip
```
3. Спецсимволы в пароле
```bash
xarch -c -f data -o secure.zip -p "P@ssw0rd!"
```

### Примеры использования ###

**Создание зашифрованного архива**
```bash
xarch -c -f secret_data.db -o vault.zip -p "my_password" -l 9 -S
```
**Распаковка с фильтрацией**
```bash
xarch -x -o backup.tar -X "*.tmp"
```
**Пакетное обновление**
```bash
xarch -u -o project.zip -f src/*.cpp include/*.h
```